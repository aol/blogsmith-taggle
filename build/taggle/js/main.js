window.ampPlugins=$.extend(window.ampPlugins,{taggle:{loaded:!0}}),function(t){"use strict";t(function(){t("#tagsidebox").easyTags()}),t.widget("aol.easyTags",{options:{namespace:"aol-easy-tags",settings:"-settings",sdk:"blogsmith",ui:{tagInput:t("#posttags"),title:"Common "+_blog_name+" Tags:",currentTags:t("#currenttags"),admin:{title:"Add, remove, or rearrange common tags for "+_blog_name,help:"Only owners and editors can change settings. Settings will affect all "+_blog_name+" users.",off:"Edit Common Tags",on:"Stop Editing Common Tags"}}},_refreshSettings:function(){this.settings=this.sdk.getKeyValue(this.options.namespace+this.options.settings)||[]},_create:function(){var e=this.options.ui;this.sdk=window[this.options.sdk],this.options.bloggerDetails=this.sdk.getBloggerDetails(),this.options.role=this.options.bloggerDetails.role,this.options.admin="Owner"===this.options.role||"Editor"===this.options.role||"Support"===this.options.role?!0:!1,this._refreshSettings(),e.tagForm=this.element.find("form"),e.header=this.element.find("h2"),e.insideBox=this.element.find(".insidebox"),e.easyTags=t("<div />",{id:"easyTags"}).prependTo(e.insideBox),e.easyTagList=t("<ul />").addClass("taggle-tag-list"),e.title&&(e.easyTagTitle=t("<h4 />",{text:e.title}).appendTo(e.easyTags)),this.settings&&t.isArray(this.settings)&&this._populateEasyTags(),e.easyTagList.children().length<=0&&e.easyTagTitle.hide(),this._addEventListeners(),this.options.admin&&(e.adminToggle=t("<img />",{"class":"admin-toggle",src:"bmedia/settings.png",title:e.admin.off}).appendTo(e.header),e.easyTagAdd=t("<img />",{"class":"add",src:"https://s.aolcdn.com/os/blogsmith/plugins/aol-tagger/images/add.png",width:"16px",height:"16px",title:"Add new tag"}).insertAfter(e.easyTagList).hide(),e.admin.title&&(e.adminTitle=t("<h4 />",{text:e.admin.title}).insertBefore(e.easyTagList).hide()),e.admin.help&&(e.adminHelp=t("<p />",{text:e.admin.help,"class":"help"}).insertBefore(e.easyTagList).hide()))},_populateEasyTags:function(){var e,s;s=this.options.ui,this.tags=this.sdk.getTags();for(var i=0,a=this.settings.length;a>i;i+=1)e=t("<li />",{text:this.settings[i]}).appendTo(s.easyTagList),-1!==this.tags.indexOf(this.settings[i])&&e.addClass("active");s.easyTagList.appendTo(s.easyTags)},_clearEasyTags:function(){this.options.ui.easyTagList.empty()},_addEventListeners:function(){var e=this.options.ui,s=this.sdk;e.easyTagList.delegate("li","click",function(i){var a,n=t(i.target);n.hasClass("active")?e.currentTags.children().each(function(e,s){var i=t(s);i.text()===n.text()&&(i.remove(),pageUpdated()),n.removeClass("active")}):(s.setTags(n.text()),n.addClass("active"),a=e.currentTags.children().filter(function(){return t(this).text()===n.text()}),a.find("img").unbind("click"),pageUpdated())}),this.element.delegate(".newremover","click",t.proxy(function(s){var i=t(s.target);e.easyTagList.children().filter(function(){return t(this).text()===i.parent().text()}).trigger("click")},this)),this.element.delegate(".add","click",t.proxy(function(){var s,i,a=this._getEasyTags();i=prompt("Enter the name of the tag you'd like to add to the list of "+_blog_name+"'s common tags."),i&&(-1===a.indexOf(i)?(s=t("<li />",{text:i}).appendTo(e.easyTagList).hide(),this._addAdminElements(s),this._saveEasyTags(),s.fadeIn("fast")):e.easyTagList.find(":contains("+i+")").effect("highlight"))},this)),e.easyTagList.delegate(".delete","click",t.proxy(function(s){var i,a=this;i=e.currentTags.children().filter(function(){return t(this).text()===t(s.target).parent().text()}),i.children(".newremover").trigger("click"),t(s.target).parent().fadeOut("fast",function(){t(this).remove(),a._saveEasyTags()})},this)),this.options.admin&&this.element.delegate(".admin-toggle","click",t.proxy(function(s){var i=t(s.target);i.hasClass("active")?(i.removeClass("active"),i.attr("title",e.admin.off),this._disableAdmin()):(i.addClass("active"),i.attr("title",e.admin.on),this._enableAdmin())},this))},_sortEasyTags:function(){var e=this.options.ui;e.easyTagList.sortable({handle:".draghandle",opacity:.5,scrollSpeed:20,stop:t.proxy(function(){this._saveEasyTags()},this),tolerance:"pointer"})},_enableAdmin:function(){var e=this.options.ui,s=200;e.easyTagTitle.hide(s),e.adminTitle.show(s),e.adminHelp.show(s),e.easyTagList.hide(s,t.proxy(function(){this._refreshSettings(),this._clearEasyTags(),this._populateEasyTags(),this._sortEasyTags(),e.easyTagList.children().each(t.proxy(function(e,s){this._addAdminElements(t(s))},this)),e.easyTagList.show(s),e.easyTagAdd.show(s)},this))},_disableAdmin:function(){var e=this.options.ui;e.easyTagAdd.hide("fast"),e.adminTitle.hide("fast"),e.adminHelp.hide("fast"),e.easyTagList.children().length>0&&e.easyTagTitle.show("fast"),e.easyTagList.hide("fast",t.proxy(function(){e.easyTagList.sortable("destroy"),e.easyTagList.find(".draghandle").remove(),e.easyTagList.find(".delete").remove(),e.easyTagList.show("fast")},this))},_addAdminElements:function(e){var s,i;s=t("<img />",{"class":"draghandle",src:"https://s.aolcdn.com/os/blogsmith/plugins/aol-tagger/images/draghandle.png",width:"12px",height:"12px"}).prependTo(e),i=t("<img />",{"class":"delete",src:"/bmedia/remtag.png",width:"8px",height:"8px"}).appendTo(e)},_getEasyTags:function(){var e=this.options.ui,s=[];return e.easyTagList.children().each(function(){s.push(t(this).text())}),s},_saveEasyTags:function(){var e=[];this.options.ui.easyTagList.children().each(function(s,i){e.push(t(i).text())}),this.sdk.setKeyValue(this.options.namespace+this.options.settings,e)},_init:function(){},_destroy:function(){}})}(jQuery,blogsmith);